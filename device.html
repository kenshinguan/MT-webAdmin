<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>设备指令</title>
		<link href="css/zui.css" rel="stylesheet" />
		<link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/page.css" rel="stylesheet" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/zui.js"></script>
		
		<script src="lib/datatable/zui.datatable.min.js"></script>
		<script src="js/common.js"></script>
	</head>

	<body class="minwidth1080">
		<div class="head">

			<ol class="breadcrumb">
				<li>
					<a href="your/url/"><i class="icon icon-home"></i>当前位置</a>
				</li>
				<li>
					<a href="your/url/">设置</a>
				</li>
				<li class="active">设备指令</li>
			</ol>
			<div class="row operationbar">
				<div class="col-md-7">
					<!--   <button class="btn btn-primary" type="button" data-moveable="true">新增用户</button>
                <button class="btn" type="button" onclick="restar()">启/停用</button>
                <button class="btn" type="button" onclick="repwd()">重置密码</button>
                <button class="btn" type="button">删除</button>-->
				</div>
				<div class="col-md-5">
					<div class="input-group">
						
						<span class="input-group-addon"><i class="icon-search"></i></span>
						<input type="text" class="form-control">

						<span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
					</div>

				</div>
			</div>

			<div class="searchbar">
				<label>设备类型</label>
				<select class="form-control" id="deviceType">
					<option value="">全部</option>
					<option value="有效">有效</option>
					<option value="删除">删除</option>
				</select>
				<button type="button" class="btn" id="js-searchBtn"><i class="icon icon-search"></i>查询</button>
			</div>
		</div>
		<div class="main">
			<div class='cols-wrap'>
				<div class="cols-main" style="width: 100%;">
					<table class="table table-striped table-bordered cardTable table-datatable datatable">
						<thead>
							<tr>
								<th style="width: 200px">操作人姓名</th>
								<th>指令类容</th>
								<th style="width: 200px">指令类型</th>
								<th style="width: 200px">创建时间</th>
								<th style="width: 200px">mid</th>

							</tr>
						</thead>
						<tbody>
						</tbody>

					</table>
				</div>
				<div class="cols-aside submenu" style="position: absolute; left: 10px; margin-left: 0; bottom: 0; top: 120px; overflow: auto">
					<div class="hd">标签选项</div>
					<ul class="bd ">

						<li class="open">
							<a href="javascript:;"><i></i>设备</a>
							<ul>
							</ul>
						</li>

					</ul>
				</div>
			</div>
		</div>
		<div class="footer row" style="margin-left: 210px">
			<div class="col-md-8 leftpage">
				<!--  <select class="form-control text-center">
                <option>10</option>
            </select>-->
				<span class="ml10">总计：<span class="total">82</span>条</span>
			</div>
			<div class="text-right col-md-4">
				<ul class="pager ">
					<!--   <li class="previous disabled" title="1"><a href="#">上一页</a></li>
                <li><a href="javascri:void(0)">…</a></li>
                <li class="active" data-page="1" title="2"><a href="#">1</a></li>
                <li data-page="2"><a href="#">2</a></li>
                <li data-page="3"><a href="#">3</a></li>
                <li data-page="4"><a href="#">4</a></li>
                <li data-page="5"><a href="#">5</a></li>
                <li><a href="javascri:void(0)">…</a></li>
                <li class="next"><a href="#">下一页</a></li>-->
				</ul>
				<input type="text" id="numtxt" />
				<input type="submit" value="跳转" class="btn" id="gotopage" />
			</div>
		</div>

	</body>

</html>
<script>
	//初始化数据表
	//$('.datatable').datatable({
	//	checkable: true,
	//	sortable: true
	//});
	var page = 1,
		pageSize = 4,
		pagecount = 0,
		$me = '';
	$(function() {
		
		getdata();

		$(".submenu ul.bd ul").on("click", "a", function() {
			$(".submenu ul.bd ul a.active").removeClass("active");
			$(this).addClass("active");
			var mid = $(this).attr("data-id");
			page = 1;
			getcommand(page, mid);
		});
		$("#js-searchBtn").click(function() {

			page = 1;
			getdata();
		})

	})

	function getdata() {

		var status = $("#deviceType").val();
		var param = {
				"page": 0,
				"pageSize": 0,
				"status": status,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId
			}
			//  alert(JSON.stringify(param));
		$.ajax({

			type: 'post',
			url: service + "device/list",
			dataType: "json",
			data: param,
			success: function(data) {

				// console.log(JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;

					var str = "";
					if(result) {
						for(var i = 0; i < result.length; i++) {

							str += ' <li ><a href="javascript:;" data-id="' + result[i].mid + '">' + result[i].deviceName + '</a></li>';
						}
						$(".submenu ul.bd ul").html(str);
						$(".submenu ul.bd ul li").eq(0).find("a").addClass("active");
						if(result.length > 0) {
							var mid = result[0].mid;
							getcommand(page, mid);
						}

					}
				}

			},
			error: function() {
				alert("发生错误");
			}
		});
	}

	function getcommand(page, mid) {
		var param = {

				"page": page,
				"pageSize": page,
				"mid": mid,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId
			}
			//  alert(JSON.stringify(param));
		$.ajax({

			type: 'post',
			url: service + "device/find_command",
			dataType: "json",
			data: param,
			success: function(data) {

				console.log(JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					pagecount = Math.ceil(data.totalSize / pageSize);

					_TOTAL = pagecount;
					_NUM = data.page;
					pager(_NUM, _TOTAL);
					var tablestr = "";
					if(result) {
						for(var i = 0; i < result.length; i++) {

							tablestr += ' <tr data-id="' + result[i].id + '"><td>' + result[i].username + '</td>' +
								'<td>' + result[i].content + '</td><td >' + result[i].type + '</td><td >' + result[i].createTime + '</td><td >' + result[i].mid + '</td></tr>';
						}
						$('table tbody').html(tablestr);

					}
					$(".total").text(data.totalSize);
				}

			},
			error: function() {
				alert("发生错误");
			}
		});

	}
</script>