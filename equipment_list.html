<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>问题</title>
		<link href="css/zui.css" rel="stylesheet" />
		<link href="css/chosen.css" rel="stylesheet" />
		<link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/page.css" rel="stylesheet" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/zui.js"></script>
		<script src="js/chosen.js"></script>
		<script src="lib/datatable/zui.datatable.min.js"></script>
		<script src="js/common.js"></script>
	</head>
	<style type="text/css">
		.modal-body .tab-detail {
			display: none;
		}
		
		.modal-body .tab-detail.on {
			display: block;
		}
		.modal-body label {
		    width: 8em;
		    color: #333;
		}
		.modal-body span {
			display: inline-block;
			width: 11em;
		    color: #333;
		    word-wrap: break-word 
		}
		.modal-body hr {
		    margin-top: 0px;
		}
	</style>

	<body class="minwidth1080">
		<div class="head">
			<div class="modal fade addModal" id="detailModal">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
							<h4 class="modal-title">设备详情</h4>
						</div>
						<div class="modal-body">
							<ul class="nav nav-secondary">
								<li class="active">
									<a href="javascript:;">网络参数</a>
								</li>
								<li>
									<a href="javascript:;">平台参数</a>
								</li>
								<li>
									<a href="javascript:;">识别器</a>
								</li>
								<li>
									<a href="javascript:;">版本</a>
								</li>
								<li>
									<a href="javascript:;">FTP配置</a>
								</li>
								<li>
									<a href="javascript:;">其他参数</a>
								</li>
							</ul>
							<p class="cols-top clearfix"></p>
							<div class="tab-detail on" id="netParam">

							</div>
							<div class="tab-detail" id="pingtaiParam">

							</div>
							<div class="tab-detail" id="shibieqi">

							</div>
							<div class="tab-detail" id="banbenxinxi">

							</div>
							<div class="tab-detail" id="FTPParam">

							</div>
							<div class="tab-detail" id="otherParam">
	
							</div>
						</div>
					</div>
				</div>
			</div>

			<ol class="breadcrumb">
				<li>
					<a href="your/url/"><i class="icon icon-home"></i>当前位置</a>
				</li>
				<li>
					<a href="your/url/">查询</a>
				</li>
				<li class="active">设备查询</li>
			</ol>
			<div class="row operationbar">
				<div class="col-md-7">
				</div>
				<div class="col-md-5">
					<div class="input-group">
						<span class="input-group-addon"><i class="icon-search"></i></span>
						<input type="text" class="form-control" id="searchKey">
						<span class="input-group-addon input-remove"><i class="icon-remove-circle"></i></span>
						<span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
					</div>
					<div class="search-group hidden" id='searchlist'>
						<div class="list-group">
							<a href="#" class="list-group-item active" data-type="equipmentName">
								在名称中查找：
								<span></span>
							</a>
							<a href="#" class="list-group-item" data-type="equipmentMid">
								在mid中查找：
								<span></span>
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="searchbar">
				<label>分类</label>
				<select class="chosen-select form-control" id="moduleCategory" multiple="">
				</select>
				<label class="ml10">标签</label>
				<select class="chosen-select form-control" id="labelType" multiple="">
				</select>
				<label class="ml10">状态</label>
				<select class="form-control" id="questionType">
					<option value="有效">有效</option>
					<option value="删除">删除</option>
					<option value="">全部</option>
				</select>
				<label class="ml10">启用</label>
				<select class="form-control" id="enableType">
					<option value="启用">启用</option>
					<option value="停用">停用</option>
				</select>
			</div>
		</div>
		<div class="main">
			<table class="table table-striped table-bordered cardTable table-datatable datatable">
				<thead>
					<tr>
						<th style="width: 7%">序号</th>
						<th style="width: 15%">MID</th>
						<th style="width: 20%">名称</th>
						<th style="width: 10%">类型</th>
						<th style="width: 10%">状态</th>
						<th style="width: 10%">启用</th>
						<th style="width: 10%">标签</th>
						<th style="width: 20%">创建时间</th>
					</tr>
				</thead>
				<tbody>
				</tbody>

			</table>
		</div>
		<div class="footer row">
			<div class="col-md-8 leftpage">
				<span class="ml10">总计：<span class="total">82</span>条</span>
				<label class="ml40">显示</label>
				<select class="form-control" id="pageSize">
					<!--<option value="10">10</option>
					<option value="20">20</option>-->
					<option value="50">50</option>
					<option value="100">100</option>
				</select>
				<label>行</label>
			</div>
			<div class="text-right col-md-4">
				<ul class="pager ">

				</ul>
				<input type="text" id="numtxt" />
				<input type="submit" value="跳转" class="btn" id="gotopage" />
			</div>
		</div>

	</body>

</html>
<script>
	//初始化数据表
	var page = 1,
		pageSize = 50,
		pagecount = 0;
	var MID = '';
	$(function() {
		$('#searchlist .list-group a').click(function() {
			$('#searchlist .list-group a.active').removeClass('active');
			$(this).addClass('active');
		});
		$('.nav-secondary li').click(function() {
			$('.nav-secondary li.active').removeClass('active');
			$(this).addClass('active');
			var index = $('.nav-secondary li').index($(this));
			$('.tab-detail').eq(index).addClass('on').siblings('.on').removeClass('on');
			eqtInfo(index);
		});
		$('.input-group-btn .btn-default').click(function() {
			page = 1;
			getdata(page);
		});

		searchkey();

		getCategory('设备');

		getTags('设备');

		getdata(page);

	});

	//页面大小选择
	$("#pageSize").bind("change", function() {
		if($(this).val() == 0) {
			return;
		} else {
			pageSize = $(this).val();
			page = 1;
			getdata(page);
		}
	});

	function openeqtInfo(eqtmid) {
		$('.nav-secondary li').removeClass('active');
		$('.nav-secondary li').eq(0).addClass('active');
		$('.tab-detail').removeClass('on');
		$('.tab-detail').eq(0).addClass('on');
		MID = eqtmid;
		getNetparamInfo();
		$("#detailModal").modal("show");
	}

	function getdata(page) {
		var categorys = '';

		if($('#moduleCategory').val() != null) {
			categorys = JSON.stringify($('#moduleCategory').val());
		}

		var labels = '';

		if($('#labelType').val() != null) {
			labels = JSON.stringify($('#labelType').val());
		}

		var status = $('#questionType').val();

		var isUsing = $('#enableType').val();

		var deviceName = '';
		var mid = '';
		var type = $('#searchlist .list-group-item.active').attr('data-type');
		if(type == 'equipmentName') {
			deviceName = $('#searchKey').val();
		} else if(type == 'equipmentMid') {
			mid = $('#searchKey').val();
		}

		var param = {
				"categorys": categorys,
				"deviceName": deviceName,
				"labels": labels,
				"mid": mid,
				"status": status,
				"isUsing": isUsing,
				"page": page,
				"pageSize": pageSize,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId
			}
			// console.log(JSON.stringify(param));
		$.ajax({
			type: 'post',
			url: service + " device/list",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log(JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					pagecount = Math.ceil(data.totalSize / pageSize);

					_TOTAL = pagecount;
					_NUM = data.page;
					pager(_NUM, _TOTAL);
					var str = "";
					if(result) {
						for(var i = 0; i < result.length; i++) {
							var labels_str = '';
							if(result[i].labels) {
								for(var j = 0; j < result[i].labels.length; j++) {
									if(result[i].labels[j]) {
										labels_str += '<div>' + result[i].labels[j].labelName + '</div>';
									}
								}
							}
							var categoryName = '';
							if(result[i].baseCategory) {
								var categoryName = result[i].baseCategory.categoryName;
							}
							str += ' <tr data-id="' + result[i].id + '"> <td>' + ((page - 1) * pageSize + (i + 1)) + '</td><td><a href="javascript:;" onclick="openeqtInfo(' + result[i].mid + ')">' + result[i].mid + '</a><td>' + result[i].deviceName + '</td><td>' + categoryName + '</td><td>' + result[i].status + '</td><td>' + result[i].enable + '</td><td>' + labels_str + '</td><td>' + result[i].createTime + '</td></tr>';
						}
						$('.main table tbody').html(str);
						$(".total").text(data.totalSize);

					}
				}

			},
			error: function() {
				alert("发生错误");
			}
		});
	}

	function eqtInfo(index) {
		if(index == 0) {
			getNetparamInfo();
		} else if(index == 1) {
			getYewupingtaiInfo();
		} else if(index == 2) {
			getShibieqiInfo();
		} else if(index == 3) {
			getBanbenxinxiInfo();
		} else if(index == 4) {
			getFTPInfo();
		} else if(index == 5) {
			getOtherInfo();
		}
	}
	/*网络参数*/
	function getNetparamInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_network/find_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('网络：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var netparam_str = '';
					if(result) {
						netparam_str += '<p><label>模块制式:</label><span>' + result.moduleStandard + '</span></p><p><label>信号值:</label><span>' + result.signals + '</span></p><hr><p><label>DHCP:</label><span>' + result.dhcp + '</span></p><p><label>IP:</label><span>' + result.ip + '</span></p><p><label>掩码:</label><span>' + result.mask + '</span></p><p><label>网关:</label><span>' + result.gateway + '</span></p><p><label>NDS:</label><span>' + result.dns + '</span></p><hr><p><label>MAC:</label><span>' + result.mac + '</span></p>';
					}
					$('#netParam').html(netparam_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*业务平台参数*/
	function getYewupingtaiInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_platform/find_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('平台：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var pingtaiparam_str = '';
					if(result) {
						var yewu_str = '<div style="float: left;">';
						var wangguan_str = '<div style="display: inline-block;margin-left: 20px;border-left: 1px solid #e5e5e5;">';
						for (var i = 0; i < result.length; i++) {
							if (result[i].type == '业务平台') {
								yewu_str += '<p><label>平台类型:</label><span>' + result[i].type + '</span></p><p><label>地址:</label><span>' +  result[i].url + '</span></p><p><label>端口:</label><span>' + result[i].port + '</span></p><p><label>账号:</label><span>' + result[i].username + '</span></p><p><label>密码:</label><span>' + result[i].password + '</span></p>';
							}
							if (result[i].type == '网管平台') {
								wangguan_str += '<p><label>平台类型:</label><span>' + result[i].type + '</span></p><p><label>服务器:</label><span>' +  result[i].serverName + '</span></p><p><label>地址:</label><span>' +  result[i].url + '</span></p><p><label>端口:</label><span>' + result[i].port + '</span></p><p><label>账号:</label><span>' + result[i].username + '</span></p><p><label>密码:</label><span>' + result[i].password + '</span></p>';
							}
						}
						yewu_str += '</div>';
						wangguan_str += '</div>';

						pingtaiparam_str = yewu_str + wangguan_str;
					}
					$('#pingtaiParam').html(pingtaiparam_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*识别器*/
	function getShibieqiInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_recognizer/find_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('识别器：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var shibieqi_str = '';
					if(result) {
						var gate1_str = '';
						var gate2_str = '';
						for (var i = 0; i < result.length; i++) {
							if (result[i].gate == 'gate1') {
								gate1_str += '<p><label>GATE1:</label><span>' + result[i].isable + '</span></p><p><label>COM1:</label><span>' + result[i].gateIn + '</span></p><p><label>COM2:</label><span>' + result[i].gateOut + '</span></p>';
							}
							if (result[i].gate == 'gate2') {
								gate2_str += '<p><label>GATE2:</label><span>' + result[i].isable + '</span></p><p><label>COM1:</label><span>' + result[i].gateIn + '</span></p><p><label>COM2:</label><span>' + result[i].gateOut + '</span></p>';
							}
						}

						shibieqi_str += gate1_str + '<hr>' + gate2_str;
					}
					$('#shibieqi').html(shibieqi_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*版本信息*/
	function getBanbenxinxiInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_version/get_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('版本信息：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var banbenxinxi_str = '';
					if(result) {
						var softxinxi_str = '<div style="float: left;"><p><label>版本类型:</label><span>软件版本</span></p>';
						var hardxinxi_str = '<div style="display: inline-block;margin-left: 20px;border-left: 1px solid #e5e5e5;"><p><label>版本类型:</label><span>硬件版本</span></p>';
						for (var i = 0; i < result.length; i++) {
							if (result[i].softVersion != null) {
								softxinxi_str += '<p><label>' + result[i].type + '</label><span>' + result[i].softVersion + '</span></p>';
							}
							if (result[i].hardVersion != null) {
								hardxinxi_str += '<p><label>' + result[i].type + '</label><span>' + result[i].hardVersion + '</span></p>';
							}
						}
						softxinxi_str += '</div>';
						hardxinxi_str += '</div>';
						banbenxinxi_str = softxinxi_str + hardxinxi_str;
					}
					$('#banbenxinxi').html(banbenxinxi_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*ftp信息*/
	function getFTPInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_ftp/find_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('FTP：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item.baseFtp;
					var FTP_str = '';
					if(result) {
					   FTP_str += '<p><label>服务器:</label><span>' + result.ftpName + '</span></p><hr><p><label>地址:</label><span>' + result.url + '</span></p><p><label>端口:</label><span>' + result.port + '</span></p><p><label>账号:</label><span>' + result.username + '</span></p><p><label>密码:</label><span>' + result.password + '</span></p><hr><p><label>串口日志:</label><span>' + result.path3 + '</span></p><p><label>附件:</label><span>' + result.path1 + '</span></p><p><label>版本:</label><span>' + result.path2 + '</span></p><p><label>告警:</label><span>' + result.path4 + '</span></p><p><label>考勤:</label><span>' + result.path5 + '</span></p>';
					}
					$('#FTPParam').html(FTP_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*其他参数*/
	function getOtherInfo() {
		var param = {
				"mid": MID,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"operater": operater,
				"clientType": 'admin'
			}
			// console.log(JSON.stringify(param));

		$.ajax({
			type: 'post',
			url: service + "device_other/find_by_mid",
			dataType: "json",
			data: param,
			success: function(data) {
				// console.log('其它参数：' + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var other_str = '';
					if(result) {
						other_str += '<p><label>心跳间隔时间:</label><span>' + result.heartbeatInterval + '秒' + '</span></p><hr><p><label>流量上报间隔:</label><span>' + result.flowReportInterval + '时'  + '</span></p><hr><p><label>上报间隔:</label><span>' + result.attendanceReportInterval + '分'  + '</span></p><hr><p><label>记录保存:</label><span>' + result.recordKeepInterval + '天'  + '</span></p><hr><p><label>每包记录数:</label><span>' + result.recordCount + '条'  + '</span></p><hr><p><label>考勤模式:</label><span>' + result.attendanceMode + '</span></p>';
					}
					$('#otherParam').html(other_str);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	// $('body').bind('click', function(event) {
	//     // IE支持 event.srcElement ， FF支持 event.target    
	//     var evt = event.srcElement ? event.srcElement : event.target;    
	//     if (evt.id == 'searchKey' ) {
	//         return; // 如果是元素本身，则返回
	//     } else {
	//         $('#searchlist').addClass('hidden');    // 如不是则隐藏元素   
	//     }
	// });
</script>