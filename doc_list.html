<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>问题</title>
    <link href="css/zui.css" rel="stylesheet" />
    <link href="css/chosen.css" rel="stylesheet" />
    <link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
    <link href="css/common.css" rel="stylesheet" />
    <link href="css/page.css" rel="stylesheet" />
    <script src="js/jquery-1.9.1.min.js"></script>
    <script src="js/zui.js"></script>
    <script src="js/chosen.js"></script>
    <script src="lib/datatable/zui.datatable.min.js"></script>
    <script src="js/common.js"></script>
</head>
<style type="text/css">
    .page_explain {
        margin-top: 20px;
        margin-bottom: 20px;
    }
</style>
<body class="minwidth1080">
    <div class="head">
      
        <ol class="breadcrumb">
            <li><a href="your/url/"><i class="icon icon-home"></i>当前位置</a></li>
            <li><a href="your/url/">查询</a></li>
            <li class="active">文档查询</li>
        </ol>
        <div class="row operationbar">
            <div class="col-md-7">
            </div>
            <div class="col-md-5">
                <div class="input-group">
                    <span class="input-group-addon"><i class="icon-search"></i></span>
                    <input type="text" class="form-control" id="searchKey">
                    <span class="input-group-addon input-remove"><i class="icon-remove-circle"></i></span>
                    <span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
                </div>
                <div class="search-group hidden" id='searchlist'>
                    <div class="list-group">
                        <a href="#" class="list-group-item active" data-type="docPid">
                            在pid中查找：
                            <span></span>
                        </a>
                    </div>
                </div>
            </div>
        </div>

        <div class="searchbar">    
                <label class="ml10">模块</label>
                <select class="form-control" id="moduleType">
                    <option value="项目">项目</option>
                    <option value="设备">设备</option>
                    <option value="设备">意见反馈</option>
                    <option value="设备">返修单</option>
                </select>
        </div>
    </div>
    <div class="main">
        <table class="table table-striped table-bordered cardTable table-datatable datatable">
            <thead>
                <tr>
                    <th style="width: 7%">序号</th>
                    <th style="width: 10%">PID</th>
                    <th style="width: 10%">模块</th>
                    <th style="width: 10%">类型</th>
                    <th style="width: 10%">地址</th>
                    <th style="width: 10%">端口</th>
                    <th style="width: 10%">路径</th>
                    <th style="width: 20%">名称</th>
                    <th style="width: 10%">创建时间</th>
                </tr>
            </thead>
            <tbody>
            </tbody>


        </table>
    </div>
    <div class="page_explain">
        <h5 class="ml10" style="color: #FF0000;">*只能通过搜索PID查询单个设备的文档记录</h5>
    </div>
</body>

</html>
<script>
    //初始化数据表
    var page = '', pageSize = '', pagecount = 0;

    $(function () {
        $('#searchlist .list-group a').click(function () {
            $('#searchlist .list-group a.active').removeClass('active');
            $(this).addClass('active');
        });
        $('.input-group-btn .btn-default').click(function() {
            page = '';
            getdata(page);
        });

        searchkey();

        // getdata(page);

    });

    function getdata(page) {
        var module = $('#moduleType').val();
        var pid = '';
        var type = $('#searchlist .list-group-item.active').attr('data-type');
        if (type == 'docPid' && $('#searchKey').val()) {
            pid = $('#searchKey').val();
        } else {
            var msg = $.zui.messager.show('请输入pid', {
                placement: 'top',
                time: '1000'
            });
            return;
        }

        var param = {
            "module": module,
            "pid": pid,
            "page": page,   
            "pageSize": pageSize,
            "sessionKey": session.sessionKey,
            "sessionId": session.sessionId,
            "operater": operater,
			"clientType": 'admin'
        }
        console.log(JSON.stringify(param));
        $.ajax({
            type: 'post',
            url: service + "affix/get_affix",
            dataType: "json",
            data: param,
            success: function (data) {
                console.log(JSON.stringify(data));
                if (data.ret == 'ok') {
                    var result = data.item[0];
                    // pagecount = Math.ceil(data.totalSize / pageSize);

                    // _TOTAL = pagecount;
                    // _NUM = data.page;
                    // pager(_NUM, _TOTAL);
                    var str = "";
                    if (result) {
                        for (var i = 0; i < result.length; i++) {
                            str += ' <tr data-id="' + result[i].id + '"> <td>' + ((page-1)*pageSize+(i+1)) + '</td><td>' + result[i].pid + '</td><td>' + result[i].module +'</td><td>' + result[i].affixType + '</td><td>' + result[i].url + '</td><td>' + result[i].port + '</td><td>' + result[i].path + '</td><td>' + result[i].affixName +'</td><td>' + result[i].createTime + '</td></tr>';
                        }
                        $('table tbody').html(str);
                        $(".total").text(data.totalSize);

                    }
                }


            },
            error: function () {
                alert("发生错误");
            }
        });
    }
</script>

