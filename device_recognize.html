<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>设备识别率查询</title>
		<link href="css/zui.css" rel="stylesheet" />
		<link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/page.css" rel="stylesheet" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/zui.js"></script>
		<script src="lib/datatable/zui.datatable.min.js"></script>
		<script src="js/common.js"></script>
	</head>
	<style type="text/css">
		.col-md-7 #add{
			display: none;
		}
	</style>

	<body class="minwidth1080">
		<div class="head">
			<ol class="breadcrumb">
				<li><a href="your/url/"><i class="icon icon-home"></i>当前位置</a></li>
				<li><a href="your/url/">版本</a></li>
				<li class="active">版本管理</li>
			</ol>
			<div class="row operationbar">
				<div class="col-md-7">
					<button class="btn btn-primary" type="button" data-moveable="true" id='add'>新增</button>
				</div>
				<div class="col-md-5">
					<div class="input-group">
						<span class="input-group-addon"><i class="icon-search"></i></span>
						<input type="text" class="form-control">

						<span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
					</div>

				</div>
			</div>
		</div>
		<div class="main">
			<table class="table table-striped table-bordered cardTable table-datatable datatable table-hover" style="width: 50%;">
				<thead>
					<tr>
						<th style="width: 160px;">设备识别率的值</th>
						<th style="width: 120px;">设备识别率</th>
						<th style="width: 140px;">操作</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
		<!--新建弹出框-->
		<div class="modal fade addModal in" id="addManager" aria-hidden="true">
			<div class="modal-dialog modal-moveable modal-dragged" style="left: 423px; top: 155.333333333333px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
						<h4 class="modal-title">新建</h4>
					</div>
					<div class="modal-body">
						<form method="" action="" class="modal-form">
							<input type="hidden" name="editId" id="editId" value="" />
							<p>
								<label for="" style="width: 100px;">设备识别率的值</label>
								<input type="text" id="add_device_value">
							</p>
						</form>
					</div>
					<div class="modal-footer text-center">
						<button type="button" class="btn btn-primary pull-left" id="savebtn">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		</div>
		<!--修改弹出框-->
		<div class="modal fade addModal in" id="editManager" aria-hidden="true">
			<div class="modal-dialog modal-moveable modal-dragged" style="left: 423px; top: 155.333333333333px;">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">×</span><span class="sr-only">关闭</span></button>
						<h4 class="modal-title">修改</h4>
					</div>
					<div class="modal-body">
						<form method="" action="" class="modal-form">
							<input type="hidden" name="editId" id="editId" value="" />
							<p>
								<label for="" style="width: 100px;">设备识别率的值</label>
								<input type="text" id="categoryName">
							</p>
						</form>
					</div>
					<div class="modal-footer text-center">
						<button type="button" class="btn btn-primary pull-left" id="submitbtn">确定</button>
						<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
					</div>
				</div>
			</div>
		</div>

	</body>

</html>
<script>
	$(function() {
		show_device();
		$('#add').click(function() {
			$('#addManager').modal('show');
		});
		$('.main table').on('click', 'a.update', function(e) {
			$('#editManager').modal('show');
			e.stopPropagation(); //阻止冒泡（会优先执行a标签的事件，然后还会执行#table的事件，这里只需要执行a标签的事件，所以需要阻止下一个事件的发生）
			var $me = $(this).parents("tr");
			var editorId = $(this).parents("tr").attr('data-id');
			$('#editId').val(editorId);
			$('#categoryName').val($me.find('td').eq(0).text());
		});
		$('#submitbtn').click(function() {
			edit_device();
		});
		$('#savebtn').click(function() {
			add_device();
		});
	});
	/*显示设备识别率的值的表格*/
	function show_device() {
		var param = {
			sessionKey: session.sessionKey,
			sessionId: session.sessionId
		}
		$.ajax({
			type: "post",
			url: service + "category/get/device_recognize_rate",
			dataType: "json",
			data: param,
			success: function(data) {
				console.log("查询数据" + JSON.stringify(data));
				if (data.ret == 'ok') {
					var result = data.item;
					var str = '';
					if (result) {
						str += '<tr data-id="' + result.id + '">' + //让要修改或删除的id隐藏起来data-后的id可以自己取名
							'<td>' + result.categoryName + '%</td>' +
							'<td>' + result.categoryType + '</td>' +
							'<td><a href="javascript:;" class="update">修改</a></td>' +
							'</tr>';
						$('table tbody').html(str);
						if (str == '') {
						$('.modal-header button').removeClass('.col-md-7 #add');
						} else {
						$('.modal_header button').addClass('.col-md-7 #add');
							
						}
					}
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*编辑设备识别率的值*/
	function edit_device() {
		var categoryName = $('#categoryName').val();
		var updateId = $('#editId').val();
		var param = {
			"sessionKey": session.sessionKey,
			"sessionId": session.sessionId,
			"categoryName": categoryName,
			"id": updateId
		}
		$.ajax({
			type: "post",
			url: service + "category/modify/device_recognize_rate",
			dataType: "json",
			data: param,
			success: function(data) {
				console.log("编辑数据" + JSON.stringify(data));
				if (data.ret == 'ok') {
					window.location.reload();
				}
				alert(data.reason);
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	/*添加设备识别率的值*/
	function add_device() {
		var categoryName = $('#add_device_value').val();
		var param = {
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId,
				"categoryName": categoryName
			}
			//alert(JSON.stringify(param));
		$.ajax({
			type: "post",
			url: service + "category/modify/device_recognize_rate",
			dataType: "json",
			data: param,
			success: function(data) {
				console.log("添加数据" + JSON.stringify(data));
				if (data.ret == "ok") {
					window.location.reload();
				} else {
					alert(data.reason);
				}
			},
			error: function() {
				alert("发生错误");
			}
		});
	}
</script>