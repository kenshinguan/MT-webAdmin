<!DOCTYPE html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>活动记录</title>
		<link href="css/zui.css" rel="stylesheet" />
		<link href="css/chosen.css" rel="stylesheet" />
		<link href="css/datetimepicker.css" rel="stylesheet" />
		<link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/page.css" rel="stylesheet" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/zui.js"></script>
		<script src="js/chosen.js"></script>
		<script src="js/datetimepicker.js"></script>
		<script src="lib/datatable/zui.datatable.min.js"></script>
		<script src="js/common.js"></script>
	</head>
	<style type="text/css">
		.page_explain {
			margin-top: 20px;
			margin-bottom: 20px;
		}
	</style>

	<body class="minwidth1080">
		<div class="head">
			<ol class="breadcrumb">
				<li>
					<a href="your/url/"><i class="icon icon-home"></i>当前位置</a>
				</li>
				<li>
					<a href="your/url/">查询</a>
				</li>
				<li class="active">活动查询</li>
			</ol>

			<div class="row operationbar">
				<div class="col-md-7">
				</div>
				<div class="col-md-5">
					<div class="input-group">
						<span class="input-group-addon"><i class="icon-search"></i></span>
						<input type="text" class="form-control" id="searchKey">
						<span class="input-group-addon input-remove"><i class="icon-remove-circle"></i></span>
						<span class="input-group-btn">
                        <button class="btn btn-default" type="button">搜索</button>
                    </span>
					</div>
					<div class="search-group hidden" id='searchlist'>
						<div class="list-group">
							</a>
							<a href="#" class="list-group-item active" data-type="equipmentMid">
								在mid中查找：
								<span></span>
							</a>
						</div>
					</div>
				</div>
			</div>

			<div class="searchbar">
				<label class="ml10">发布日期</label>
				<input type="text" name="" id="" value="" class="form-control time" readonly="readonly" />
				<label class="ml10">模块名称</label>
				<select class="form-control" id="moduleType">
					<option value="项目">项目</option>
					<option value="设备">设备</option>
					<option value="设备">意见反馈</option>
					<option value="设备">返修单</option>
				</select>
			</div>
		</div>

		<div class="main">
			<table class="table table-striped table-bordered cardTable table-datatable datatable">
				<thead>
					<tr>
						<th style="width: 7%">序号</th>
						<th style="width: 10%">MID</th>
						<th style="width: 10%">类型</th>
						<th style="width: 20%">创建人</th>
						<th style="width: 30%">内容</th>
						<th style="width: 20%">创建时间</th>
					</tr>
				</thead>
				<tbody>

				</tbody>
			</table>
		</div>
	</body>
	<div class="page_explain">
		<h5 class="ml10" style="color: #FF0000;">*只能通过搜索MID查询单个设备的活动记录</h5>
	</div>

</html>
<script>
	//初始化数据表
	var page = '',
		pageSize = '',
		pagecount = 0;
	$(function() {
		$('#searchlist .list-group a').click(function() {
			$('#searchlist .list-group a.active').removeClass('active');
			$(this).addClass('active');
		});
		$('.input-group-btn .btn-default').click(function() {
			page = '';
			show_activty(page);
		});
		var mydata = new Date();
		var today = mydata.getFullYear() + '-' + (mydata.getMonth() + 1);
		$('.time').val(today);
		$('.time').selectMonth();

		searchkey();
	});

	function show_activty(page) {
		var module = $('#moduleType').val();
		var time = $('.time').val();
		var mid = '';
		var type = $('#searchlist .list-group-item.active').attr('data-type');
		if(type == 'equipmentMid' && $('#searchKey').val()) {
			mid = $('#searchKey').val();
		} else {
			var msg = $.zui.messager.show('请输入mid', {
				placement: 'top',
				time: '1000'
			});
			return;
		}

		var param = {
			mid: mid,
			time: time,
			module: module,
			sessionId: session.sessionId,
			sessionKey: session.sessionKey,
			"operater": operater,
			"clientType": 'admin'
		}
		console.log("显示活动记录参数" + JSON.stringify(param));
		$.ajax({
			type: 'post',
			url: service + "device_active_log/get_all",
			dataType: "json",
			data: param,
			success: function(data) {
				console.log("显示活动记录数据" + JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					var str = '';
					if(result) {
						for(var i = 0; i < result.length; i++) {
							str += '<tr><td>' + ((page - 1) * pageSize + (i + 1)) + '</td>' +
								'<td>' + result[i].mid + '</td>' +
								'<td>' + result[i].type + '</td><td>' + result[i].username + '</td>' +
								'<td>' + result[i].content + '</td><td>' + result[i].createTime + '</td>' +
								'</tr>'
						}
						$('.main table tbody').html(str);
					}
				}
			},
			error: function() {
				alert("发生错误!");
			}
		});
	}
</script>