<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="UTF-8">
		<title>问题</title>
		<link href="css/zui.css" rel="stylesheet" />
		<link href="css/chosen.css" rel="stylesheet" />
		<link href="lib/datatable/zui.datatable.min.css" rel="stylesheet" />
		<link href="css/common.css" rel="stylesheet" />
		<link href="css/page.css" rel="stylesheet" />
		<script src="js/jquery-1.9.1.min.js"></script>
		<script src="js/zui.js"></script>
		<script src="js/chosen.js"></script>
		<script src="lib/datatable/zui.datatable.min.js"></script>
		<script src="js/common.js"></script>
	</head>
	<body class="minwidth1080">
		<div class="head">

			<ol class="breadcrumb">
				<li>
					<a href="your/url/"><i class="icon icon-home"></i>当前位置</a>
				</li>
				<li>
					<a href="your/url/">查询</a>
				</li>
				<li class="active">问题反馈</li>
			</ol>
			<div class="row operationbar">
				<div class="col-md-7">
				</div>
				<div class="col-md-5">
					<div class="input-group">
						<span class="input-group-addon"><i class="icon-search"></i></span>
						<input type="text" class="form-control" id="searchKey">
						<span class="input-group-addon input-remove"><i class="icon-remove-circle"></i></span>
						<span class="input-group-btn">
                        	<button class="btn btn-default" type="button">搜索</button>
                    	</span>
					</div>

				</div>
			</div>

			<div class="searchbar">
                <label>分类</label>
                <select class="chosen-select form-control" id="moduleCategory" multiple="">
                </select>
                <label class="ml10">标签</label>
                <select class="chosen-select form-control" id="labelType" multiple="">
                </select>  
				<label class="ml10">问题状态</label>
				<select class="form-control" id="questionType">
					<option value="">全部</option>
					<option value="有效">未处理</option>
					<option value="关闭">已处理</option>
				</select>
			</div>
		</div>
		<div class="main">
			<table class="table table-striped table-bordered cardTable table-datatable datatable">
				<thead>
					<tr>
						<th style="width: 7%">序号</th>
						<th style="width: 10%">提交姓名</th>
						<th style="width: 30%">问题描述</th>
						<th style="width: 10%">问题状态</th>
						<th style="width: 20%">创建时间</th>
						<th style="width: 20%">关联项目</th>

					</tr>
				</thead>
				<tbody>
				</tbody>

			</table>
		</div>
		<div class="footer row">
			<div class="col-md-8 leftpage">
				<span class="ml10">总计：<span class="total">82</span>条</span>
	            <label class="ml40">显示</label>
	            <select class="form-control" id="pageSize">
	                <!--<option value="10">10</option>
	                <option value="20">20</option>-->
	                <option value="50">50</option>
	                <option value="100">100</option>
	            </select>
	            <label>行</label>
			</div>
			<div class="text-right col-md-4">
				<ul class="pager ">
				</ul>
				<input type="text" id="numtxt" />
				<input type="submit" value="跳转" class="btn" id="gotopage" />
			</div>
		</div>

	</body>

</html>
<script>
	//初始化数据表
	//$('.datatable').datatable({
	//	checkable: true,
	//	sortable: true
	//});
	var page = 1,
		pageSize = 50,
		pagecount = 0;

	$(function() {
        $('.input-group-btn .btn-default').click(function() {
            page = 1;
            getdata(page);
        });

        searchkey();

        getCategory('反馈');

        getTags('反馈');

		getdata(page);
	});

    //页面大小选择
    $("#pageSize").bind("change",function(){ 
        if($(this).val() == 0) {
            return; 
        } else {
            pageSize = $(this).val();
            page = 1;
            getdata(page);
        } 
    });

	function getdata(page) {
        categorys = '';

        if ($('#moduleCategory').val() != null) {
            categorys = JSON.stringify($('#moduleCategory').val());
        }

        labels = '';

        if ($('#labelType').val() != null) {
            labels = JSON.stringify($('#labelType').val());
        }

        status = $("#questionType").val();

        describer = $('#searchKey').val();

		var param = {
				"describer": describer,
				"categorys": categorys,
				"labels": labels,
				"status": status,
				"page": page,
				"pageSize": pageSize,
				"sessionKey": session.sessionKey,
				"sessionId": session.sessionId
			}
		console.log(JSON.stringify(param));
		$.ajax({
			type: 'post',
			url: service + "feed_back/list",
			dataType: "json",
			data: param,
			success: function(data) {

				console.log(JSON.stringify(data));
				if(data.ret == 'ok') {
					var result = data.item;
					pagecount = Math.ceil(data.totalSize / pageSize);

					_TOTAL = pagecount;
					_NUM = data.page;
					pager(_NUM, _TOTAL);
					var str = "";
					if(result) {
						for(var i = 0; i < result.length; i++) {
							var userlist = result;
							var username = ''
							if(userlist[i].baseUser) {
								username = userlist[i].baseUser.username;
							}
							str += ' <tr data-id="' + userlist[i].id + '"> <td>' + ((page-1)*pageSize+(i+1)) + '</td><td>' + username + '</td><td>' + userlist[i].describer + '</td><td>' + userlist[i].status + '</td><td>' + userlist[i].createTime + '</td>' +
								' <td>' + userlist[i].moduleProject.projectName + '</td></tr>';
						}
						$('table tbody').html(str);
						$(".total").text(data.totalSize);
					}
				}

			},
			error: function() {
				alert("发生错误");
			}
		});
	}
	
</script>